
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.4, mkdocs-material-7.3.0">
    
    
      
        <title>Cite Filter - manubot</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.8b42a75e.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.3f5d1f46.min.css">
        
          
          
          <meta name="theme-color" content="#4cae4f">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="green" data-md-color-accent="lightgreen">
  
    
    <script>function __prefix(e){return new URL("../../../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#module-manubotpandoccite_filter" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="manubot" class="md-header__button md-logo" aria-label="manubot" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            manubot
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Cite Filter
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/manubot/manubot/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    manubot
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="manubot" class="md-nav__button md-logo" aria-label="manubot" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    manubot
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/manubot/manubot/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    manubot
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../LICENSE/" class="md-nav__link">
        License
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1">
          Manubot
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Manubot" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          Manubot
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../command/" class="md-nav__link">
        Command
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../util/" class="md-nav__link">
        Util
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_4" type="checkbox" id="__nav_3_1_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1_4">
          Cite
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Cite" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_1_4">
          <span class="md-nav__icon md-icon"></span>
          Cite
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cite/arxiv/" class="md-nav__link">
        Arxiv
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cite/citations/" class="md-nav__link">
        Citations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cite/cite_command/" class="md-nav__link">
        Cite Command
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cite/citekey/" class="md-nav__link">
        Citekey
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cite/citeproc/" class="md-nav__link">
        Citeproc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cite/csl_item/" class="md-nav__link">
        Csl Item
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cite/curie/" class="md-nav__link">
        Curie
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cite/doi/" class="md-nav__link">
        Doi
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cite/handlers/" class="md-nav__link">
        Handlers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cite/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cite/isbn/" class="md-nav__link">
        Isbn
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cite/pubmed/" class="md-nav__link">
        Pubmed
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cite/unpaywall/" class="md-nav__link">
        Unpaywall
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cite/url/" class="md-nav__link">
        Url
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cite/wikidata/" class="md-nav__link">
        Wikidata
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cite/zotero/" class="md-nav__link">
        Zotero
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_4_17" type="checkbox" id="__nav_3_1_4_17" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1_4_17">
          Tests
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tests" data-md-level="4">
        <label class="md-nav__title" for="__nav_3_1_4_17">
          <span class="md-nav__icon md-icon"></span>
          Tests
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cite/tests/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cite/tests/test_arxiv/" class="md-nav__link">
        Test Arxiv
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cite/tests/test_citations/" class="md-nav__link">
        Test Citations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cite/tests/test_cite_command/" class="md-nav__link">
        Test Cite Command
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cite/tests/test_citekey/" class="md-nav__link">
        Test Citekey
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cite/tests/test_citekey_api/" class="md-nav__link">
        Test Citekey Api
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cite/tests/test_citeproc/" class="md-nav__link">
        Test Citeproc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cite/tests/test_csl_item/" class="md-nav__link">
        Test Csl Item
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cite/tests/test_curie/" class="md-nav__link">
        Test Curie
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cite/tests/test_doi/" class="md-nav__link">
        Test Doi
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cite/tests/test_handlers/" class="md-nav__link">
        Test Handlers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cite/tests/test_isbn/" class="md-nav__link">
        Test Isbn
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cite/tests/test_pubmed/" class="md-nav__link">
        Test Pubmed
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cite/tests/test_unpaywall/" class="md-nav__link">
        Test Unpaywall
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cite/tests/test_url/" class="md-nav__link">
        Test Url
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cite/tests/test_wikidata/" class="md-nav__link">
        Test Wikidata
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cite/tests/test_zotero/" class="md-nav__link">
        Test Zotero
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_5" type="checkbox" id="__nav_3_1_5" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1_5">
          Pandoc
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Pandoc" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_1_5">
          <span class="md-nav__icon md-icon"></span>
          Pandoc
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../bibliography/" class="md-nav__link">
        Bibliography
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Cite Filter
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Cite Filter
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#options" class="md-nav__link">
    Options
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#development-commands" class="md-nav__link">
    development commands
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#main" class="md-nav__link">
    main
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parse_args" class="md-nav__link">
    parse_args
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#process_citations" class="md-nav__link">
    process_citations
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../util/" class="md-nav__link">
        Util
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_6" type="checkbox" id="__nav_3_1_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1_6">
          Process
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Process" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_1_6">
          <span class="md-nav__icon md-icon"></span>
          Process
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../process/bibliography/" class="md-nav__link">
        Bibliography
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../process/ci/" class="md-nav__link">
        Ci
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../process/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../process/manuscript/" class="md-nav__link">
        Manuscript
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../process/metadata/" class="md-nav__link">
        Metadata
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../process/process_command/" class="md-nav__link">
        Process Command
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../process/requests_cache/" class="md-nav__link">
        Requests Cache
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../process/util/" class="md-nav__link">
        Util
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_6_9" type="checkbox" id="__nav_3_1_6_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1_6_9">
          Tests
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tests" data-md-level="4">
        <label class="md-nav__title" for="__nav_3_1_6_9">
          <span class="md-nav__icon md-icon"></span>
          Tests
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../process/tests/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../process/tests/test_bibliography/" class="md-nav__link">
        Test Bibliography
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../process/tests/test_ci/" class="md-nav__link">
        Test Ci
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../process/tests/test_metadata/" class="md-nav__link">
        Test Metadata
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../process/tests/test_process_command/" class="md-nav__link">
        Test Process Command
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../process/tests/test_util/" class="md-nav__link">
        Test Util
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_7" type="checkbox" id="__nav_3_1_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1_7">
          Tests
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tests" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_1_7">
          <span class="md-nav__icon md-icon"></span>
          Tests
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tests/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tests/test_command/" class="md-nav__link">
        Test Command
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tests/test_imports/" class="md-nav__link">
        Test Imports
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tests/test_readme/" class="md-nav__link">
        Test Readme
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tests/test_util/" class="md-nav__link">
        Test Util
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_8" type="checkbox" id="__nav_3_1_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1_8">
          Webpage
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Webpage" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_1_8">
          <span class="md-nav__icon md-icon"></span>
          Webpage
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../webpage/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../webpage/webpage_command/" class="md-nav__link">
        Webpage Command
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#options" class="md-nav__link">
    Options
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#development-commands" class="md-nav__link">
    development commands
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#main" class="md-nav__link">
    main
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parse_args" class="md-nav__link">
    parse_args
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#process_citations" class="md-nav__link">
    process_citations
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/manubot/manubot/edit/main/reference/manubot/pandoc/cite_filter.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="module-manubotpandoccite_filter">Module manubot.pandoc.cite_filter</h1>
<p>This module defines a pandoc filter for manubot cite functionality.</p>
<p>The filter can be called with the <code>pandoc-manubot-cite</code> command.</p>
<h2 id="options">Options</h2>
<p>Configuration is provided via Pandoc metadata fields.</p>
<ul>
<li>
<p><code>bibliography</code> (sequence of strings):
  Use to define reference metadata manually.
  Pandoc supports specifying multiple external bibliography files.
  When bibliography files are specified,
  this filter will read them instead of pandoc.
  Behavior should be similar to Pandoc,
  with format inferred by extension:
  .json for CSL JSON,
  .yaml for CSL YAML,
  .bib for BibLaTeX.</p>
</li>
<li>
<p><code>references</code> (sequence of CSL-Item mappings):
  Same as Pandoc's references metadata field.</p>
</li>
<li>
<p><code>citekey-aliases</code> (mapping: string -&gt; string):
  Used to define aliases (tags) for cite-by-id citations.
  Useful when a citation is used many times or contains invalid characters.
  Aliases can also be defined in markdown with link reference syntax.</p>
</li>
<li>
<p><code>manubot-infer-citekey-prefixes</code> (boolean):
  Attempt to infer the prefix for citekeys without a known prefix.
  For example, allow '@10.1371/journal.pcbi.1007128' with a 'doi:' prefix.
  Default is true.</p>
</li>
<li>
<p><code>manubot-output-citekeys</code> (string):
  path to write TSV table of citekeys
  showing their transformation from input_id to short_id.</p>
</li>
<li>
<p><code>manubot-bibliography-cache</code> (string):
  Path to read and write bibliographic metadata as CSL JSON/YAML.
  Intended as a human-editable cache of the bibliography data,
  for situations where this filter is run multiple times.
  This is similar to specifying bibliography=FILE and manubot-output-bibliography=FILE in a single argument,
  but will not error trying to read a bibliography file that does not yet exist.</p>
</li>
<li>
<p><code>manubot-output-bibliography</code> (string):
  path to write generated CSL JSON bibliography.
  If specified in addition to <code>manubot-bibliography-cache</code>,
  two output bibliographies will be written (with the same references).</p>
</li>
<li>
<p><code>manubot-requests-cache-path</code> (string):
  Enable caching HTTP requests to this path (minus the extension) using <a href="https://github.com/reclosedev/requests-cache">requests-cache</a>.
  For example, setting to <code>.cache/requests-cache</code> will cache requests to <code>.cache/requests-cache.sqlite</code>.</p>
</li>
<li>
<p><code>manubot-clear-requests-cache</code> (boolean):
  If true, clear the requests cache at <code>manubot-requests-cache-path</code>.</p>
</li>
<li>
<p><code>manubot-fail-on-errors</code> (boolean):
  If true, return a nonzero exit status if any errors are logged.
  Default is false, which allows Pandoc to proceed when some citations could not be processed.</p>
</li>
</ul>
<h2 id="development-commands">development commands</h2>
<div class="codehilite"><pre><span></span><code><span class="c1"># export to plain text (with pandoc &lt; 2.11)</span>
pandoc   --to<span class="o">=</span>plain   --standalone   --filter<span class="o">=</span>pandoc-manubot-cite   --filter<span class="o">=</span>pandoc-citeproc   manubot/pandoc/tests/test_cite_filter/input.md

<span class="c1"># call the filter manually using pandoc JSON output</span>
pandoc   --to<span class="o">=</span>json   manubot/pandoc/tests/test_cite_filter/input.md   <span class="p">|</span> python manubot/pandoc/test_cite.py markdown
</code></pre></div>

<p>Related resources on pandoc filters:</p>
<ul>
<li><a href="https://github.com/jgm/pandocfilters">python pandocfilters package</a></li>
<li><a href="https://github.com/sergiocorreia/panflute">python panflute package</a></li>
<li><a href="http://scorreia.com/software/panflute/code.html#panflute.elements.Citation">panflute Citation class</a></li>
</ul>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="s">&quot;&quot;&quot;</span>

<span class="n">This</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="n">defines</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">pandoc</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">manubot</span><span class="w"> </span><span class="n">cite</span><span class="w"> </span><span class="n">functionality</span><span class="p">.</span><span class="w"></span>

<span class="n">The</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">called</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="err">`</span><span class="n">pandoc</span><span class="o">-</span><span class="n">manubot</span><span class="o">-</span><span class="n">cite</span><span class="err">`</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="w"></span>

<span class="cp">## Options</span>

<span class="n">Configuration</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">provided</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">Pandoc</span><span class="w"> </span><span class="n">metadata</span><span class="w"> </span><span class="n">fields</span><span class="p">.</span><span class="w"></span>

<span class="o">-</span><span class="w"> </span><span class="err">`</span><span class="n">bibliography</span><span class="err">`</span><span class="w"> </span><span class="p">(</span><span class="n">sequence</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">strings</span><span class="p">)</span><span class="o">:</span><span class="w"></span>

<span class="w">  </span><span class="n">Use</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">define</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="n">metadata</span><span class="w"> </span><span class="n">manually</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="n">Pandoc</span><span class="w"> </span><span class="n">supports</span><span class="w"> </span><span class="n">specifying</span><span class="w"> </span><span class="n">multiple</span><span class="w"> </span><span class="n">external</span><span class="w"> </span><span class="n">bibliography</span><span class="w"> </span><span class="n">files</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="n">When</span><span class="w"> </span><span class="n">bibliography</span><span class="w"> </span><span class="n">files</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">specified</span><span class="p">,</span><span class="w"></span>

<span class="w">  </span><span class="n">this</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">them</span><span class="w"> </span><span class="n">instead</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">pandoc</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="n">Behavior</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">similar</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">Pandoc</span><span class="p">,</span><span class="w"></span>

<span class="w">  </span><span class="n">with</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="n">inferred</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">extension</span><span class="o">:</span><span class="w"></span>

<span class="w">  </span><span class="p">.</span><span class="n">json</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">CSL</span><span class="w"> </span><span class="n">JSON</span><span class="p">,</span><span class="w"></span>

<span class="w">  </span><span class="p">.</span><span class="n">yaml</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">CSL</span><span class="w"> </span><span class="n">YAML</span><span class="p">,</span><span class="w"></span>

<span class="w">  </span><span class="p">.</span><span class="n">bib</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">BibLaTeX</span><span class="p">.</span><span class="w"></span>

<span class="o">-</span><span class="w"> </span><span class="err">`</span><span class="n">references</span><span class="err">`</span><span class="w"> </span><span class="p">(</span><span class="n">sequence</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">CSL</span><span class="o">-</span><span class="n">Item</span><span class="w"> </span><span class="n">mappings</span><span class="p">)</span><span class="o">:</span><span class="w"></span>

<span class="w">  </span><span class="n">Same</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">Pandoc</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">references</span><span class="w"> </span><span class="n">metadata</span><span class="w"> </span><span class="n">field</span><span class="p">.</span><span class="w"></span>

<span class="o">-</span><span class="w"> </span><span class="err">`</span><span class="n">citekey</span><span class="o">-</span><span class="n">aliases</span><span class="err">`</span><span class="w"> </span><span class="p">(</span><span class="n">mapping</span><span class="o">:</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">string</span><span class="p">)</span><span class="o">:</span><span class="w"></span>

<span class="w">  </span><span class="n">Used</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">define</span><span class="w"> </span><span class="n">aliases</span><span class="w"> </span><span class="p">(</span><span class="n">tags</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">cite</span><span class="o">-</span><span class="n">by</span><span class="o">-</span><span class="kt">id</span><span class="w"> </span><span class="n">citations</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="n">Useful</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">citation</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">many</span><span class="w"> </span><span class="n">times</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">contains</span><span class="w"> </span><span class="n">invalid</span><span class="w"> </span><span class="n">characters</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="n">Aliases</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">markdown</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">link</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="n">syntax</span><span class="p">.</span><span class="w"></span>

<span class="o">-</span><span class="w"> </span><span class="err">`</span><span class="n">manubot</span><span class="o">-</span><span class="n">infer</span><span class="o">-</span><span class="n">citekey</span><span class="o">-</span><span class="n">prefixes</span><span class="err">`</span><span class="w"> </span><span class="p">(</span><span class="n">boolean</span><span class="p">)</span><span class="o">:</span><span class="w"></span>

<span class="w">  </span><span class="n">Attempt</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">infer</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">prefix</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">citekeys</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">known</span><span class="w"> </span><span class="n">prefix</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="n">For</span><span class="w"> </span><span class="n">example</span><span class="p">,</span><span class="w"> </span><span class="n">allow</span><span class="w"> </span><span class="err">&#39;</span><span class="mf">@10.1371</span><span class="o">/</span><span class="n">journal</span><span class="p">.</span><span class="n">pcbi</span><span class="mf">.1007128</span><span class="err">&#39;</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="err">&#39;</span><span class="n">doi</span><span class="o">:</span><span class="err">&#39;</span><span class="w"> </span><span class="n">prefix</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="n">Default</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="nb">true</span><span class="p">.</span><span class="w"></span>

<span class="o">-</span><span class="w"> </span><span class="err">`</span><span class="n">manubot</span><span class="o">-</span><span class="n">output</span><span class="o">-</span><span class="n">citekeys</span><span class="err">`</span><span class="w"> </span><span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="o">:</span><span class="w"></span>

<span class="w">  </span><span class="n">path</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="n">TSV</span><span class="w"> </span><span class="n">table</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">citekeys</span><span class="w"></span>

<span class="w">  </span><span class="n">showing</span><span class="w"> </span><span class="n">their</span><span class="w"> </span><span class="n">transformation</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">input_id</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">short_id</span><span class="p">.</span><span class="w"></span>

<span class="o">-</span><span class="w"> </span><span class="err">`</span><span class="n">manubot</span><span class="o">-</span><span class="n">bibliography</span><span class="o">-</span><span class="n">cache</span><span class="err">`</span><span class="w"> </span><span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="o">:</span><span class="w"></span>

<span class="w">  </span><span class="n">Path</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="n">bibliographic</span><span class="w"> </span><span class="n">metadata</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">CSL</span><span class="w"> </span><span class="n">JSON</span><span class="o">/</span><span class="n">YAML</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="n">Intended</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">human</span><span class="o">-</span><span class="n">editable</span><span class="w"> </span><span class="n">cache</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">bibliography</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"></span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="n">situations</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">multiple</span><span class="w"> </span><span class="n">times</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="n">This</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">similar</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">specifying</span><span class="w"> </span><span class="n">bibliography</span><span class="o">=</span><span class="kt">FILE</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">manubot</span><span class="o">-</span><span class="n">output</span><span class="o">-</span><span class="n">bibliography</span><span class="o">=</span><span class="kt">FILE</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">single</span><span class="w"> </span><span class="n">argument</span><span class="p">,</span><span class="w"></span>

<span class="w">  </span><span class="n">but</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">bibliography</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">yet</span><span class="w"> </span><span class="n">exist</span><span class="p">.</span><span class="w"></span>

<span class="o">-</span><span class="w"> </span><span class="err">`</span><span class="n">manubot</span><span class="o">-</span><span class="n">output</span><span class="o">-</span><span class="n">bibliography</span><span class="err">`</span><span class="w"> </span><span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="o">:</span><span class="w"></span>

<span class="w">  </span><span class="n">path</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="n">generated</span><span class="w"> </span><span class="n">CSL</span><span class="w"> </span><span class="n">JSON</span><span class="w"> </span><span class="n">bibliography</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="n">If</span><span class="w"> </span><span class="n">specified</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">addition</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="err">`</span><span class="n">manubot</span><span class="o">-</span><span class="n">bibliography</span><span class="o">-</span><span class="n">cache</span><span class="err">`</span><span class="p">,</span><span class="w"></span>

<span class="w">  </span><span class="n">two</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="n">bibliographies</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">written</span><span class="w"> </span><span class="p">(</span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">references</span><span class="p">).</span><span class="w"></span>

<span class="o">-</span><span class="w"> </span><span class="err">`</span><span class="n">manubot</span><span class="o">-</span><span class="n">requests</span><span class="o">-</span><span class="n">cache</span><span class="o">-</span><span class="n">path</span><span class="err">`</span><span class="w"> </span><span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="o">:</span><span class="w"></span>

<span class="w">  </span><span class="n">Enable</span><span class="w"> </span><span class="n">caching</span><span class="w"> </span><span class="n">HTTP</span><span class="w"> </span><span class="n">requests</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="p">(</span><span class="n">minus</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">extension</span><span class="p">)</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="p">[</span><span class="n">requests</span><span class="o">-</span><span class="n">cache</span><span class="p">](</span><span class="n">https</span><span class="o">:</span><span class="c1">//github.com/reclosedev/requests-cache).</span>

<span class="w">  </span><span class="n">For</span><span class="w"> </span><span class="n">example</span><span class="p">,</span><span class="w"> </span><span class="n">setting</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="err">`</span><span class="p">.</span><span class="n">cache</span><span class="o">/</span><span class="n">requests</span><span class="o">-</span><span class="n">cache</span><span class="err">`</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">cache</span><span class="w"> </span><span class="n">requests</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="err">`</span><span class="p">.</span><span class="n">cache</span><span class="o">/</span><span class="n">requests</span><span class="o">-</span><span class="n">cache</span><span class="p">.</span><span class="n">sqlite</span><span class="err">`</span><span class="p">.</span><span class="w"></span>

<span class="o">-</span><span class="w"> </span><span class="err">`</span><span class="n">manubot</span><span class="o">-</span><span class="n">clear</span><span class="o">-</span><span class="n">requests</span><span class="o">-</span><span class="n">cache</span><span class="err">`</span><span class="w"> </span><span class="p">(</span><span class="n">boolean</span><span class="p">)</span><span class="o">:</span><span class="w"></span>

<span class="w">  </span><span class="n">If</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="n">clear</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">requests</span><span class="w"> </span><span class="n">cache</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="err">`</span><span class="n">manubot</span><span class="o">-</span><span class="n">requests</span><span class="o">-</span><span class="n">cache</span><span class="o">-</span><span class="n">path</span><span class="err">`</span><span class="p">.</span><span class="w"></span>

<span class="o">-</span><span class="w"> </span><span class="err">`</span><span class="n">manubot</span><span class="o">-</span><span class="n">fail</span><span class="o">-</span><span class="n">on</span><span class="o">-</span><span class="n">errors</span><span class="err">`</span><span class="w"> </span><span class="p">(</span><span class="n">boolean</span><span class="p">)</span><span class="o">:</span><span class="w"></span>

<span class="w">  </span><span class="n">If</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">nonzero</span><span class="w"> </span><span class="n">exit</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">errors</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">logged</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="n">Default</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">allows</span><span class="w"> </span><span class="n">Pandoc</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">proceed</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">some</span><span class="w"> </span><span class="n">citations</span><span class="w"> </span><span class="n">could</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">processed</span><span class="p">.</span><span class="w"></span>

<span class="cp">## development commands</span>

<span class="err">```</span><span class="n">shell</span><span class="w"></span>

<span class="cp"># export to plain text (with pandoc &lt; 2.11)</span>

<span class="n">pandoc</span><span class="w"> </span>\

<span class="w">  </span><span class="o">--</span><span class="n">to</span><span class="o">=</span><span class="n">plain</span><span class="w"> </span>\

<span class="w">  </span><span class="o">--</span><span class="n">standalone</span><span class="w"> </span>\

<span class="w">  </span><span class="o">--</span><span class="n">filter</span><span class="o">=</span><span class="n">pandoc</span><span class="o">-</span><span class="n">manubot</span><span class="o">-</span><span class="n">cite</span><span class="w"> </span>\

<span class="w">  </span><span class="o">--</span><span class="n">filter</span><span class="o">=</span><span class="n">pandoc</span><span class="o">-</span><span class="n">citeproc</span><span class="w"> </span>\

<span class="w">  </span><span class="n">manubot</span><span class="o">/</span><span class="n">pandoc</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">test_cite_filter</span><span class="o">/</span><span class="n">input</span><span class="p">.</span><span class="n">md</span><span class="w"></span>

<span class="cp"># call the filter manually using pandoc JSON output</span>

<span class="n">pandoc</span><span class="w"> </span>\

<span class="w">  </span><span class="o">--</span><span class="n">to</span><span class="o">=</span><span class="n">json</span><span class="w"> </span>\

<span class="w">  </span><span class="n">manubot</span><span class="o">/</span><span class="n">pandoc</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">test_cite_filter</span><span class="o">/</span><span class="n">input</span><span class="p">.</span><span class="n">md</span><span class="w"> </span>\

<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">python</span><span class="w"> </span><span class="n">manubot</span><span class="o">/</span><span class="n">pandoc</span><span class="o">/</span><span class="n">test_cite</span><span class="p">.</span><span class="n">py</span><span class="w"> </span><span class="n">markdown</span><span class="w"></span>

<span class="err">```</span><span class="w"></span>

<span class="n">Related</span><span class="w"> </span><span class="n">resources</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">pandoc</span><span class="w"> </span><span class="n">filters</span><span class="o">:</span><span class="w"></span>

<span class="o">-</span><span class="w"> </span><span class="p">[</span><span class="n">python</span><span class="w"> </span><span class="n">pandocfilters</span><span class="w"> </span><span class="n">package</span><span class="p">](</span><span class="n">https</span><span class="o">:</span><span class="c1">//github.com/jgm/pandocfilters)</span>

<span class="o">-</span><span class="w"> </span><span class="p">[</span><span class="n">python</span><span class="w"> </span><span class="n">panflute</span><span class="w"> </span><span class="n">package</span><span class="p">](</span><span class="n">https</span><span class="o">:</span><span class="c1">//github.com/sergiocorreia/panflute)</span>

<span class="o">-</span><span class="w"> </span><span class="p">[</span><span class="n">panflute</span><span class="w"> </span><span class="n">Citation</span><span class="w"> </span><span class="k">class</span><span class="p">](</span><span class="n">http</span><span class="o">:</span><span class="c1">//scorreia.com/software/panflute/code.html#panflute.elements.Citation)</span>

<span class="s">&quot;&quot;&quot;</span>

<span class="n">import</span><span class="w"> </span><span class="n">argparse</span><span class="w"></span>

<span class="n">import</span><span class="w"> </span><span class="n">logging</span><span class="w"></span>

<span class="n">import</span><span class="w"> </span><span class="n">os</span><span class="w"></span>

<span class="n">from</span><span class="w"> </span><span class="n">typing</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="n">Any</span><span class="p">,</span><span class="w"> </span><span class="n">Dict</span><span class="w"></span>

<span class="n">import</span><span class="w"> </span><span class="n">panflute</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">pf</span><span class="w"></span>

<span class="n">from</span><span class="w"> </span><span class="n">manubot</span><span class="p">.</span><span class="n">cite</span><span class="p">.</span><span class="n">citations</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="n">Citations</span><span class="w"></span>

<span class="n">def</span><span class="w"> </span><span class="n">parse_args</span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">argparse</span><span class="p">.</span><span class="n">Namespace</span><span class="o">:</span><span class="w"></span>

<span class="w">    </span><span class="s">&quot;&quot;&quot;</span>

<span class="w">    </span><span class="n">Read</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="n">arguments</span><span class="w"></span>

<span class="w">    </span><span class="s">&quot;&quot;&quot;</span>

<span class="w">    </span><span class="n">parser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="w"></span>

<span class="w">        </span><span class="n">description</span><span class="o">=</span><span class="s">&quot;Pandoc filter for citation by persistent identifier. &quot;</span><span class="w"></span>

<span class="w">        </span><span class="s">&quot;Filters are command-line programs that read and write a JSON-encoded abstract syntax tree for Pandoc. &quot;</span><span class="w"></span>

<span class="w">        </span><span class="s">&quot;Unless you are debugging, run this filter as part of a pandoc command by specifying --filter=pandoc-manubot-cite.&quot;</span><span class="w"></span>

<span class="w">    </span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="w"></span>

<span class="w">        </span><span class="s">&quot;target_format&quot;</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="n">help</span><span class="o">=</span><span class="s">&quot;output format of the pandoc command, as per Pandoc&#39;s --to option&quot;</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="w"></span>

<span class="w">        </span><span class="s">&quot;--input&quot;</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="n">nargs</span><span class="o">=</span><span class="s">&quot;?&quot;</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="n">type</span><span class="o">=</span><span class="n">argparse</span><span class="p">.</span><span class="n">FileType</span><span class="p">(</span><span class="s">&quot;r&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">encoding</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">),</span><span class="w"></span>

<span class="w">        </span><span class="n">help</span><span class="o">=</span><span class="s">&quot;path read JSON input (defaults to stdin)&quot;</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="w"></span>

<span class="w">        </span><span class="s">&quot;--output&quot;</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="n">nargs</span><span class="o">=</span><span class="s">&quot;?&quot;</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="n">type</span><span class="o">=</span><span class="n">argparse</span><span class="p">.</span><span class="n">FileType</span><span class="p">(</span><span class="s">&quot;w&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">encoding</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">),</span><span class="w"></span>

<span class="w">        </span><span class="n">help</span><span class="o">=</span><span class="s">&quot;path to write JSON output (defaults to stdout)&quot;</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">()</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">args</span><span class="w"></span>

<span class="n">def</span><span class="w"> </span><span class="n">_get_citekeys_action</span><span class="p">(</span><span class="n">elem</span><span class="o">:</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">Element</span><span class="p">,</span><span class="w"> </span><span class="n">doc</span><span class="o">:</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">Doc</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">None</span><span class="o">:</span><span class="w"></span>

<span class="w">    </span><span class="s">&quot;&quot;&quot;</span>

<span class="w">    </span><span class="n">Panflute</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">extract</span><span class="w"> </span><span class="n">citationId</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">Citations</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">AST</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="s">&quot;&quot;&quot;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="nf">isinstance</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">Citation</span><span class="p">)</span><span class="o">:</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">None</span><span class="w"></span>

<span class="w">    </span><span class="n">manuscript_citekeys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">doc</span><span class="p">.</span><span class="n">manubot</span><span class="p">[</span><span class="s">&quot;manuscript_citekeys&quot;</span><span class="p">]</span><span class="w"></span>

<span class="w">    </span><span class="n">manuscript_citekeys</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">.</span><span class="kt">id</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">None</span><span class="w"></span>

<span class="n">def</span><span class="w"> </span><span class="n">_citation_to_id_action</span><span class="p">(</span><span class="n">elem</span><span class="o">:</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">Element</span><span class="p">,</span><span class="w"> </span><span class="n">doc</span><span class="o">:</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">Doc</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">None</span><span class="o">:</span><span class="w"></span>

<span class="w">    </span><span class="s">&quot;&quot;&quot;</span>

<span class="w">    </span><span class="n">Panflute</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">citationId</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Citations</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">AST</span><span class="w"></span>

<span class="w">    </span><span class="n">with</span><span class="w"> </span><span class="n">their</span><span class="w"> </span><span class="n">manubot</span><span class="o">-</span><span class="n">created</span><span class="w"> </span><span class="n">keys</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="s">&quot;&quot;&quot;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">Citation</span><span class="p">)</span><span class="o">:</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">None</span><span class="w"></span>

<span class="w">    </span><span class="n">mapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">doc</span><span class="p">.</span><span class="n">manubot</span><span class="p">[</span><span class="s">&quot;citekey_shortener&quot;</span><span class="p">]</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">elem</span><span class="p">.</span><span class="kt">id</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">mapper</span><span class="o">:</span><span class="w"></span>

<span class="w">        </span><span class="n">elem</span><span class="p">.</span><span class="kt">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mapper</span><span class="p">[</span><span class="n">elem</span><span class="p">.</span><span class="kt">id</span><span class="p">]</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">None</span><span class="w"></span>

<span class="n">def</span><span class="w"> </span><span class="n">_get_reference_link_citekey_aliases</span><span class="p">(</span><span class="n">elem</span><span class="o">:</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">Element</span><span class="p">,</span><span class="w"> </span><span class="n">doc</span><span class="o">:</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">Doc</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">None</span><span class="o">:</span><span class="w"></span>

<span class="w">    </span><span class="s">&quot;&quot;&quot;</span>

<span class="w">    </span><span class="n">Extract</span><span class="w"> </span><span class="n">citekey</span><span class="w"> </span><span class="n">aliases</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">document</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">were</span><span class="w"> </span><span class="n">defined</span><span class="w"></span>

<span class="w">    </span><span class="n">using</span><span class="w"> </span><span class="n">markdown</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">link</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="n">syntax</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="nl">https</span><span class="p">:</span><span class="c1">//spec.commonmark.org/0.29/#link-reference-definitions</span>

<span class="w">    </span><span class="n">Based</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">pandoc</span><span class="o">-</span><span class="n">url2cite</span><span class="w"> </span><span class="n">implementation</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">phiresky</span><span class="w"> </span><span class="n">at</span><span class="w"></span>

<span class="w">    </span><span class="nl">https</span><span class="p">:</span><span class="c1">//github.com/phiresky/pandoc-url2cite/blob/b28374a9a037a5ce1747b8567160d8dffd64177e/index.ts#L118-L152</span>

<span class="w">    </span><span class="s">&quot;&quot;&quot;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">type</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">Para</span><span class="o">:</span><span class="w"></span>

<span class="w">        </span><span class="cp"># require link reference definitions to be in their own paragraph</span>

<span class="w">        </span><span class="k">return</span><span class="w"></span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="w"></span>

<span class="w">        </span><span class="n">len</span><span class="p">(</span><span class="n">elem</span><span class="p">.</span><span class="n">content</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>

<span class="w">        </span><span class="n">and</span><span class="w"> </span><span class="n">type</span><span class="p">(</span><span class="n">elem</span><span class="p">.</span><span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">Cite</span><span class="w"></span>

<span class="w">        </span><span class="n">and</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="n">elem</span><span class="p">.</span><span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">citations</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>

<span class="w">        </span><span class="n">and</span><span class="w"> </span><span class="n">type</span><span class="p">(</span><span class="n">elem</span><span class="p">.</span><span class="n">content</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">Str</span><span class="w"></span>

<span class="w">        </span><span class="n">and</span><span class="w"> </span><span class="n">elem</span><span class="p">.</span><span class="n">content</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">text</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;:&quot;</span><span class="w"></span>

<span class="w">    </span><span class="p">)</span><span class="o">:</span><span class="w"></span>

<span class="w">        </span><span class="cp"># paragraph consists of at least a Cite (with one Citation),</span>

<span class="w">        </span><span class="cp"># a Str (equal to &quot;:&quot;), and additional elements, such as a</span>

<span class="w">        </span><span class="cp"># link destination and possibly more link-reference definitions.</span>

<span class="w">        </span><span class="n">dest_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">type</span><span class="p">(</span><span class="n">elem</span><span class="p">.</span><span class="n">content</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">{</span><span class="n">pf</span><span class="p">.</span><span class="n">Space</span><span class="p">,</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">SoftBreak</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>

<span class="w">        </span><span class="n">destination</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">elem</span><span class="p">.</span><span class="n">content</span><span class="p">[</span><span class="n">dest_index</span><span class="p">]</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">type</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">Str</span><span class="o">:</span><span class="w"></span>

<span class="w">            </span><span class="cp"># prevent infinite loop as per https:</span><span class="c1">//github.com/manubot/manubot/pull/302#issuecomment-906743300</span>

<span class="w">            </span><span class="n">logging</span><span class="p">.</span><span class="n">warning</span><span class="p">(</span><span class="w"></span>

<span class="w">                </span><span class="n">f</span><span class="s">&quot;Unsupported destination type {type(destination)} in link reference syntax:</span><span class="se">\n</span><span class="s">{elem.to_json()}&quot;</span><span class="w"></span>

<span class="w">            </span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">break</span><span class="w"></span>

<span class="w">        </span><span class="cp"># paragraph starts with `[@something]: something`</span>

<span class="w">        </span><span class="cp"># save info to citekeys and remove from paragraph</span>

<span class="w">        </span><span class="n">citekey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">elem</span><span class="p">.</span><span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">citations</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="kt">id</span><span class="w"></span>

<span class="w">        </span><span class="n">citekey_aliases</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">doc</span><span class="p">.</span><span class="n">manubot</span><span class="p">[</span><span class="s">&quot;citekey_aliases&quot;</span><span class="p">]</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">citekey</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">citekey_aliases</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">citekey_aliases</span><span class="p">[</span><span class="n">citekey</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">destination</span><span class="p">.</span><span class="n">text</span><span class="o">:</span><span class="w"></span>

<span class="w">            </span><span class="n">logging</span><span class="p">.</span><span class="n">warning</span><span class="p">(</span><span class="n">f</span><span class="s">&quot;multiple aliases defined for @{citekey}&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">citekey_aliases</span><span class="p">[</span><span class="n">citekey</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">destination</span><span class="p">.</span><span class="n">text</span><span class="w"></span>

<span class="w">        </span><span class="cp"># found citation, add it to citekeys and remove it from document</span>

<span class="w">        </span><span class="n">elem</span><span class="p">.</span><span class="n">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">elem</span><span class="p">.</span><span class="n">content</span><span class="p">[</span><span class="n">dest_index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">:</span><span class="p">]</span><span class="w"></span>

<span class="w">        </span><span class="cp"># remove leading SoftBreak, before continuing</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="n">elem</span><span class="p">.</span><span class="n">content</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">type</span><span class="p">(</span><span class="n">elem</span><span class="p">.</span><span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">SoftBreak</span><span class="o">:</span><span class="w"></span>

<span class="w">            </span><span class="n">elem</span><span class="p">.</span><span class="n">content</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"></span>

<span class="n">def</span><span class="w"> </span><span class="n">_get_load_manual_references_kwargs</span><span class="p">(</span><span class="n">doc</span><span class="o">:</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">Doc</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Dict</span><span class="p">[</span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="n">Any</span><span class="p">]</span><span class="o">:</span><span class="w"></span>

<span class="w">    </span><span class="s">&quot;&quot;&quot;</span>

<span class="w">    </span><span class="n">Return</span><span class="w"> </span><span class="n">keyword</span><span class="w"> </span><span class="n">arguments</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Citations</span><span class="p">.</span><span class="n">load_manual_references</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="s">&quot;&quot;&quot;</span>

<span class="w">    </span><span class="n">manual_refs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">doc</span><span class="p">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s">&quot;references&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">default</span><span class="o">=</span><span class="p">[])</span><span class="w"></span>

<span class="w">    </span><span class="n">bibliography_paths</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">doc</span><span class="p">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s">&quot;bibliography&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">default</span><span class="o">=</span><span class="p">[])</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">bibliography_paths</span><span class="p">,</span><span class="w"> </span><span class="n">list</span><span class="p">)</span><span class="o">:</span><span class="w"></span>

<span class="w">        </span><span class="n">bibliography_paths</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">bibliography_paths</span><span class="p">]</span><span class="w"></span>

<span class="w">    </span><span class="n">bibliography_cache_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">doc</span><span class="p">.</span><span class="n">manubot</span><span class="p">[</span><span class="s">&quot;bibliography_cache&quot;</span><span class="p">]</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"></span>

<span class="w">        </span><span class="n">bibliography_cache_path</span><span class="w"></span>

<span class="w">        </span><span class="n">and</span><span class="w"> </span><span class="n">bibliography_cache_path</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">bibliography_paths</span><span class="w"></span>

<span class="w">        </span><span class="n">and</span><span class="w"> </span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">bibliography_cache_path</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="p">)</span><span class="o">:</span><span class="w"></span>

<span class="w">        </span><span class="n">bibliography_paths</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">bibliography_cache_path</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">dict</span><span class="p">(</span><span class="w"></span>

<span class="w">        </span><span class="n">paths</span><span class="o">=</span><span class="n">bibliography_paths</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="n">extra_csl_items</span><span class="o">=</span><span class="n">manual_refs</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="p">)</span><span class="w"></span>

<span class="n">def</span><span class="w"> </span><span class="n">process_citations</span><span class="p">(</span><span class="n">doc</span><span class="o">:</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">Doc</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">None</span><span class="o">:</span><span class="w"></span>

<span class="w">    </span><span class="s">&quot;&quot;&quot;</span>

<span class="w">    </span><span class="n">Apply</span><span class="w"> </span><span class="n">citation</span><span class="o">-</span><span class="n">by</span><span class="o">-</span><span class="n">identifier</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Python</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="n">representation</span><span class="w"> </span><span class="n">of</span><span class="w"></span>

<span class="w">    </span><span class="n">Pandoc</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">Abstract</span><span class="w"> </span><span class="n">Syntax</span><span class="w"> </span><span class="n">Tree</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="s">&quot;&quot;&quot;</span>

<span class="w">    </span><span class="cp"># process metadata.manubot-bibliography-cache</span>

<span class="w">    </span><span class="n">bib_cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">doc</span><span class="p">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s">&quot;manubot-bibliography-cache&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="p">(</span><span class="n">bib_cache</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">None</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">bib_cache</span><span class="p">,</span><span class="w"> </span><span class="n">str</span><span class="p">))</span><span class="o">:</span><span class="w"></span>

<span class="w">        </span><span class="n">logging</span><span class="p">.</span><span class="n">warning</span><span class="p">(</span><span class="w"></span>

<span class="w">            </span><span class="n">f</span><span class="s">&quot;Expected metadata.manubot-bibliography-cache to be a string or null (None), &quot;</span><span class="w"></span>

<span class="w">            </span><span class="n">f</span><span class="s">&quot;but received a {bib_cache.__class__.__name__}. Setting to None.&quot;</span><span class="w"></span>

<span class="w">        </span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">bib_cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">None</span><span class="w"></span>

<span class="w">    </span><span class="n">doc</span><span class="p">.</span><span class="n">manubot</span><span class="p">[</span><span class="s">&quot;bibliography_cache&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bib_cache</span><span class="w"></span>

<span class="w">    </span><span class="cp"># process metadata.citekey-aliases</span>

<span class="w">    </span><span class="n">citekey_aliases</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">doc</span><span class="p">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s">&quot;citekey-aliases&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">default</span><span class="o">=</span><span class="p">{})</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">citekey_aliases</span><span class="p">,</span><span class="w"> </span><span class="n">dict</span><span class="p">)</span><span class="o">:</span><span class="w"></span>

<span class="w">        </span><span class="n">logging</span><span class="p">.</span><span class="n">warning</span><span class="p">(</span><span class="w"></span>

<span class="w">            </span><span class="n">f</span><span class="s">&quot;Expected metadata.citekey-aliases to be a dict, &quot;</span><span class="w"></span>

<span class="w">            </span><span class="n">f</span><span class="s">&quot;but received a {citekey_aliases.__class__.__name__}. Disregarding.&quot;</span><span class="w"></span>

<span class="w">        </span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">citekey_aliases</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dict</span><span class="p">()</span><span class="w"></span>

<span class="w">    </span><span class="n">doc</span><span class="p">.</span><span class="n">manubot</span><span class="p">[</span><span class="s">&quot;citekey_aliases&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">citekey_aliases</span><span class="w"></span>

<span class="w">    </span><span class="n">doc</span><span class="p">.</span><span class="n">walk</span><span class="p">(</span><span class="n">_get_reference_link_citekey_aliases</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">doc</span><span class="p">.</span><span class="n">walk</span><span class="p">(</span><span class="n">_get_citekeys_action</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">manuscript_citekeys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">doc</span><span class="p">.</span><span class="n">manubot</span><span class="p">[</span><span class="s">&quot;manuscript_citekeys&quot;</span><span class="p">]</span><span class="w"></span>

<span class="w">    </span><span class="n">citations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Citations</span><span class="p">(</span><span class="w"></span>

<span class="w">        </span><span class="n">input_ids</span><span class="o">=</span><span class="n">manuscript_citekeys</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="n">aliases</span><span class="o">=</span><span class="n">citekey_aliases</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="n">infer_citekey_prefixes</span><span class="o">=</span><span class="n">doc</span><span class="p">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="w"></span>

<span class="w">            </span><span class="s">&quot;manubot-infer-citekey-prefixes&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">default</span><span class="o">=</span><span class="n">True</span><span class="w"></span>

<span class="w">        </span><span class="p">),</span><span class="w"></span>

<span class="w">    </span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">citations</span><span class="p">.</span><span class="n">csl_item_failure_log_level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ERROR&quot;</span><span class="w"></span>

<span class="w">    </span><span class="n">requests_cache_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">doc</span><span class="p">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s">&quot;manubot-requests-cache-path&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">requests_cache_path</span><span class="o">:</span><span class="w"></span>

<span class="w">        </span><span class="n">from</span><span class="w"> </span><span class="n">manubot</span><span class="p">.</span><span class="n">process</span><span class="p">.</span><span class="n">requests_cache</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="n">RequestsCache</span><span class="w"></span>

<span class="w">        </span><span class="n">req_cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RequestsCache</span><span class="p">(</span><span class="n">requests_cache_path</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">req_cache</span><span class="p">.</span><span class="n">mkdir</span><span class="p">()</span><span class="w"></span>

<span class="w">        </span><span class="n">req_cache</span><span class="p">.</span><span class="n">install</span><span class="p">()</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">doc</span><span class="p">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s">&quot;manubot-clear-requests-cache&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">default</span><span class="o">=</span><span class="n">False</span><span class="p">)</span><span class="o">:</span><span class="w"></span>

<span class="w">            </span><span class="n">req_cache</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span><span class="w"></span>

<span class="w">    </span><span class="n">citations</span><span class="p">.</span><span class="n">filter_pandoc_xnos</span><span class="p">()</span><span class="w"></span>

<span class="w">    </span><span class="n">citations</span><span class="p">.</span><span class="n">load_manual_references</span><span class="p">(</span><span class="o">**</span><span class="n">_get_load_manual_references_kwargs</span><span class="p">(</span><span class="n">doc</span><span class="p">))</span><span class="w"></span>

<span class="w">    </span><span class="n">citations</span><span class="p">.</span><span class="n">inspect</span><span class="p">(</span><span class="n">log_level</span><span class="o">=</span><span class="s">&quot;WARNING&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">citations</span><span class="p">.</span><span class="n">get_csl_items</span><span class="p">()</span><span class="w"></span>

<span class="w">    </span><span class="n">doc</span><span class="p">.</span><span class="n">manubot</span><span class="p">[</span><span class="s">&quot;citekey_shortener&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">citations</span><span class="p">.</span><span class="n">input_to_csl_id</span><span class="w"></span>

<span class="w">    </span><span class="n">doc</span><span class="p">.</span><span class="n">walk</span><span class="p">(</span><span class="n">_citation_to_id_action</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">requests_cache_path</span><span class="o">:</span><span class="w"></span>

<span class="w">        </span><span class="n">req_cache</span><span class="p">.</span><span class="n">close</span><span class="p">()</span><span class="w"></span>

<span class="w">    </span><span class="n">citations</span><span class="p">.</span><span class="n">write_citekeys_tsv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">doc</span><span class="p">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s">&quot;manubot-output-citekeys&quot;</span><span class="p">))</span><span class="w"></span>

<span class="w">    </span><span class="n">citations</span><span class="p">.</span><span class="n">write_csl_items</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">doc</span><span class="p">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s">&quot;manubot-output-bibliography&quot;</span><span class="p">))</span><span class="w"></span>

<span class="w">    </span><span class="n">citations</span><span class="p">.</span><span class="n">write_csl_items</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">doc</span><span class="p">.</span><span class="n">manubot</span><span class="p">[</span><span class="s">&quot;bibliography_cache&quot;</span><span class="p">])</span><span class="w"></span>

<span class="w">    </span><span class="cp"># Update pandoc metadata with fields that this filter</span>

<span class="w">    </span><span class="cp"># has either consumed, created, or modified.</span>

<span class="w">    </span><span class="n">doc</span><span class="p">.</span><span class="n">metadata</span><span class="p">[</span><span class="s">&quot;bibliography&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>

<span class="w">    </span><span class="n">doc</span><span class="p">.</span><span class="n">metadata</span><span class="p">[</span><span class="s">&quot;references&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">citations</span><span class="p">.</span><span class="n">csl_items</span><span class="w"></span>

<span class="w">    </span><span class="n">doc</span><span class="p">.</span><span class="n">metadata</span><span class="p">[</span><span class="s">&quot;citekey_aliases&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">citekey_aliases</span><span class="w"></span>

<span class="n">def</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">None</span><span class="o">:</span><span class="w"></span>

<span class="w">    </span><span class="n">from</span><span class="w"> </span><span class="n">manubot</span><span class="p">.</span><span class="n">command</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="n">exit_if_error_handler_fired</span><span class="p">,</span><span class="w"> </span><span class="n">setup_logging_and_errors</span><span class="w"></span>

<span class="w">    </span><span class="n">diagnostics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">setup_logging_and_errors</span><span class="p">()</span><span class="w"></span>

<span class="w">    </span><span class="n">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parse_args</span><span class="p">()</span><span class="w"></span>

<span class="w">    </span><span class="cp"># Let panflute handle io to sys.stdout / sys.stdin to set utf-8 encoding.</span>

<span class="w">    </span><span class="cp"># args.input=None for stdin, args.output=None for stdout</span>

<span class="w">    </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pf</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">input_stream</span><span class="o">=</span><span class="n">args</span><span class="p">.</span><span class="n">input</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">log_level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">doc</span><span class="p">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s">&quot;manubot-log-level&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;WARNING&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">diagnostics</span><span class="p">[</span><span class="s">&quot;logger&quot;</span><span class="p">].</span><span class="n">setLevel</span><span class="p">(</span><span class="n">getattr</span><span class="p">(</span><span class="n">logging</span><span class="p">,</span><span class="w"> </span><span class="n">log_level</span><span class="p">))</span><span class="w"></span>

<span class="w">    </span><span class="n">logging</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="n">f</span><span class="s">&quot;Input Pandoc metadata:</span><span class="se">\n</span><span class="s">{doc.get_metadata()}&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">doc</span><span class="p">.</span><span class="n">manubot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;manuscript_citekeys&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[]}</span><span class="w"></span>

<span class="w">    </span><span class="n">process_citations</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">pf</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span><span class="w"> </span><span class="n">output_stream</span><span class="o">=</span><span class="n">args</span><span class="p">.</span><span class="n">output</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">doc</span><span class="p">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s">&quot;manubot-fail-on-errors&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">False</span><span class="p">)</span><span class="o">:</span><span class="w"></span>

<span class="w">        </span><span class="n">exit_if_error_handler_fired</span><span class="p">(</span><span class="n">diagnostics</span><span class="p">[</span><span class="s">&quot;error_handler&quot;</span><span class="p">])</span><span class="w"></span>

<span class="k">if</span><span class="w"> </span><span class="n">__name__</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;__main__&quot;</span><span class="o">:</span><span class="w"></span>

<span class="w">    </span><span class="n">main</span><span class="p">()</span><span class="w"></span>
</code></pre></div>

</details>
<h2 id="functions">Functions</h2>
<h3 id="main">main</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">main</span><span class="p">(</span>

<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

    <span class="kn">from</span> <span class="nn">manubot.command</span> <span class="kn">import</span> <span class="n">exit_if_error_handler_fired</span><span class="p">,</span> <span class="n">setup_logging_and_errors</span>

    <span class="n">diagnostics</span> <span class="o">=</span> <span class="n">setup_logging_and_errors</span><span class="p">()</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parse_args</span><span class="p">()</span>

    <span class="c1"># Let panflute handle io to sys.stdout / sys.stdin to set utf-8 encoding.</span>

    <span class="c1"># args.input=None for stdin, args.output=None for stdout</span>

    <span class="n">doc</span> <span class="o">=</span> <span class="n">pf</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">input_stream</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">input</span><span class="p">)</span>

    <span class="n">log_level</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;manubot-log-level&quot;</span><span class="p">,</span> <span class="s2">&quot;WARNING&quot;</span><span class="p">)</span>

    <span class="n">diagnostics</span><span class="p">[</span><span class="s2">&quot;logger&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">logging</span><span class="p">,</span> <span class="n">log_level</span><span class="p">))</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input Pandoc metadata:</span><span class="se">\n</span><span class="si">{</span><span class="n">doc</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">doc</span><span class="o">.</span><span class="n">manubot</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;manuscript_citekeys&quot;</span><span class="p">:</span> <span class="p">[]}</span>

    <span class="n">process_citations</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>

    <span class="n">pf</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">output_stream</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">doc</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;manubot-fail-on-errors&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>

        <span class="n">exit_if_error_handler_fired</span><span class="p">(</span><span class="n">diagnostics</span><span class="p">[</span><span class="s2">&quot;error_handler&quot;</span><span class="p">])</span>
</code></pre></div>

</details>
<h3 id="parse_args">parse_args</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">parse_args</span><span class="p">(</span>

<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span>
</code></pre></div>

<p>Read command line arguments</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">parse_args</span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">argparse</span><span class="p">.</span><span class="n">Namespace</span><span class="o">:</span><span class="w"></span>

<span class="w">    </span><span class="s">&quot;&quot;&quot;</span>

<span class="s">    Read command line arguments</span>

<span class="s">    &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">    </span><span class="n">parser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="w"></span>

<span class="w">        </span><span class="n">description</span><span class="o">=</span><span class="s">&quot;Pandoc filter for citation by persistent identifier. &quot;</span><span class="w"></span>

<span class="w">        </span><span class="s">&quot;Filters are command-line programs that read and write a JSON-encoded abstract syntax tree for Pandoc. &quot;</span><span class="w"></span>

<span class="w">        </span><span class="s">&quot;Unless you are debugging, run this filter as part of a pandoc command by specifying --filter=pandoc-manubot-cite.&quot;</span><span class="w"></span>

<span class="w">    </span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="w"></span>

<span class="w">        </span><span class="s">&quot;target_format&quot;</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="n">help</span><span class="o">=</span><span class="s">&quot;output format of the pandoc command, as per Pandoc&#39;</span><span class="n">s</span><span class="w"> </span><span class="o">--</span><span class="n">to</span><span class="w"> </span><span class="n">option</span><span class="s">&quot;,</span>

<span class="s">    )</span>

<span class="s">    parser.add_argument(</span>

<span class="s">        &quot;</span><span class="o">--</span><span class="n">input</span><span class="s">&quot;,</span>

<span class="s">        nargs=&quot;</span><span class="o">?</span><span class="s">&quot;,</span>

<span class="s">        type=argparse.FileType(&quot;</span><span class="n">r</span><span class="s">&quot;, encoding=&quot;</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span><span class="s">&quot;),</span>

<span class="s">        help=&quot;</span><span class="n">path</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">JSON</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="p">(</span><span class="n">defaults</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">stdin</span><span class="p">)</span><span class="s">&quot;,</span>

<span class="s">    )</span>

<span class="s">    parser.add_argument(</span>

<span class="s">        &quot;</span><span class="o">--</span><span class="kr">output</span><span class="s">&quot;,</span>

<span class="s">        nargs=&quot;</span><span class="o">?</span><span class="s">&quot;,</span>

<span class="s">        type=argparse.FileType(&quot;</span><span class="n">w</span><span class="s">&quot;, encoding=&quot;</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span><span class="s">&quot;),</span>

<span class="s">        help=&quot;</span><span class="n">path</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="n">JSON</span><span class="w"> </span><span class="kr">output</span><span class="w"> </span><span class="p">(</span><span class="n">defaults</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">stdout</span><span class="p">)</span><span class="s">&quot;,</span>

<span class="s">    )</span>

<span class="s">    args = parser.parse_args()</span>

<span class="s">    return args</span>
</code></pre></div>

</details>
<h3 id="process_citations">process_citations</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">process_citations</span><span class="p">(</span>
    <span class="n">doc</span><span class="p">:</span> <span class="n">panflute</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">Doc</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

<p>Apply citation-by-identifier to a Python object representation of</p>
<p>Pandoc's Abstract Syntax Tree.</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">process_citations</span><span class="p">(</span><span class="n">doc</span><span class="p">:</span><span class="w"> </span><span class="n">pf</span><span class="o">.</span><span class="n">Doc</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">None</span><span class="p">:</span><span class="w"></span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Apply citation-by-identifier to a Python object representation of</span>

<span class="sd">    Pandoc&#39;s Abstract Syntax Tree.</span>

<span class="sd">    &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">    </span><span class="c1"># process metadata.manubot-bibliography-cache</span><span class="w"></span>

<span class="w">    </span><span class="n">bib_cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">doc</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;manubot-bibliography-cache&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="p">(</span><span class="n">bib_cache</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">None</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">bib_cache</span><span class="p">,</span><span class="w"> </span><span class="nb">str</span><span class="p">)):</span><span class="w"></span>

<span class="w">        </span><span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="w"></span>

<span class="w">            </span><span class="n">f</span><span class="s2">&quot;Expected metadata.manubot-bibliography-cache to be a string or null (None), &quot;</span><span class="w"></span>

<span class="w">            </span><span class="n">f</span><span class="s2">&quot;but received a {bib_cache.__class__.__name__}. Setting to None.&quot;</span><span class="w"></span>

<span class="w">        </span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">bib_cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">None</span><span class="w"></span>

<span class="w">    </span><span class="n">doc</span><span class="o">.</span><span class="n">manubot</span><span class="p">[</span><span class="s2">&quot;bibliography_cache&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bib_cache</span><span class="w"></span>

<span class="w">    </span><span class="c1"># process metadata.citekey-aliases</span><span class="w"></span>

<span class="w">    </span><span class="n">citekey_aliases</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">doc</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;citekey-aliases&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">default</span><span class="o">=</span><span class="p">{})</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">citekey_aliases</span><span class="p">,</span><span class="w"> </span><span class="n">dict</span><span class="p">):</span><span class="w"></span>

<span class="w">        </span><span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="w"></span>

<span class="w">            </span><span class="n">f</span><span class="s2">&quot;Expected metadata.citekey-aliases to be a dict, &quot;</span><span class="w"></span>

<span class="w">            </span><span class="n">f</span><span class="s2">&quot;but received a {citekey_aliases.__class__.__name__}. Disregarding.&quot;</span><span class="w"></span>

<span class="w">        </span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">citekey_aliases</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dict</span><span class="p">()</span><span class="w"></span>

<span class="w">    </span><span class="n">doc</span><span class="o">.</span><span class="n">manubot</span><span class="p">[</span><span class="s2">&quot;citekey_aliases&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">citekey_aliases</span><span class="w"></span>

<span class="w">    </span><span class="n">doc</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">_get_reference_link_citekey_aliases</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">doc</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">_get_citekeys_action</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">manuscript_citekeys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">doc</span><span class="o">.</span><span class="n">manubot</span><span class="p">[</span><span class="s2">&quot;manuscript_citekeys&quot;</span><span class="p">]</span><span class="w"></span>

<span class="w">    </span><span class="n">citations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Citations</span><span class="p">(</span><span class="w"></span>

<span class="w">        </span><span class="n">input_ids</span><span class="o">=</span><span class="n">manuscript_citekeys</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="n">aliases</span><span class="o">=</span><span class="n">citekey_aliases</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="n">infer_citekey_prefixes</span><span class="o">=</span><span class="n">doc</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="w"></span>

<span class="w">            </span><span class="s2">&quot;manubot-infer-citekey-prefixes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">default</span><span class="o">=</span><span class="n">True</span><span class="w"></span>

<span class="w">        </span><span class="p">),</span><span class="w"></span>

<span class="w">    </span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">citations</span><span class="o">.</span><span class="n">csl_item_failure_log_level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ERROR&quot;</span><span class="w"></span>

<span class="w">    </span><span class="n">requests_cache_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">doc</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;manubot-requests-cache-path&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">requests_cache_path</span><span class="p">:</span><span class="w"></span>

<span class="w">        </span><span class="n">from</span><span class="w"> </span><span class="n">manubot</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">requests_cache</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="n">RequestsCache</span><span class="w"></span>

<span class="w">        </span><span class="n">req_cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RequestsCache</span><span class="p">(</span><span class="n">requests_cache_path</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">req_cache</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span><span class="w"></span>

<span class="w">        </span><span class="n">req_cache</span><span class="o">.</span><span class="n">install</span><span class="p">()</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">doc</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;manubot-clear-requests-cache&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">default</span><span class="o">=</span><span class="n">False</span><span class="p">):</span><span class="w"></span>

<span class="w">            </span><span class="n">req_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span><span class="w"></span>

<span class="w">    </span><span class="n">citations</span><span class="o">.</span><span class="n">filter_pandoc_xnos</span><span class="p">()</span><span class="w"></span>

<span class="w">    </span><span class="n">citations</span><span class="o">.</span><span class="n">load_manual_references</span><span class="p">(</span><span class="o">**</span><span class="n">_get_load_manual_references_kwargs</span><span class="p">(</span><span class="n">doc</span><span class="p">))</span><span class="w"></span>

<span class="w">    </span><span class="n">citations</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="n">log_level</span><span class="o">=</span><span class="s2">&quot;WARNING&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">citations</span><span class="o">.</span><span class="n">get_csl_items</span><span class="p">()</span><span class="w"></span>

<span class="w">    </span><span class="n">doc</span><span class="o">.</span><span class="n">manubot</span><span class="p">[</span><span class="s2">&quot;citekey_shortener&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">citations</span><span class="o">.</span><span class="n">input_to_csl_id</span><span class="w"></span>

<span class="w">    </span><span class="n">doc</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">_citation_to_id_action</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">requests_cache_path</span><span class="p">:</span><span class="w"></span>

<span class="w">        </span><span class="n">req_cache</span><span class="o">.</span><span class="n">close</span><span class="p">()</span><span class="w"></span>

<span class="w">    </span><span class="n">citations</span><span class="o">.</span><span class="n">write_citekeys_tsv</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">doc</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;manubot-output-citekeys&quot;</span><span class="p">))</span><span class="w"></span>

<span class="w">    </span><span class="n">citations</span><span class="o">.</span><span class="n">write_csl_items</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">doc</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;manubot-output-bibliography&quot;</span><span class="p">))</span><span class="w"></span>

<span class="w">    </span><span class="n">citations</span><span class="o">.</span><span class="n">write_csl_items</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">doc</span><span class="o">.</span><span class="n">manubot</span><span class="p">[</span><span class="s2">&quot;bibliography_cache&quot;</span><span class="p">])</span><span class="w"></span>

<span class="w">    </span><span class="c1"># Update pandoc metadata with fields that this filter</span><span class="w"></span>

<span class="w">    </span><span class="c1"># has either consumed, created, or modified.</span><span class="w"></span>

<span class="w">    </span><span class="n">doc</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;bibliography&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>

<span class="w">    </span><span class="n">doc</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;references&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">citations</span><span class="o">.</span><span class="n">csl_items</span><span class="w"></span>

<span class="w">    </span><span class="n">doc</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;citekey_aliases&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">citekey_aliases</span><span class="w"></span>
</code></pre></div>

</details>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../bibliography/" title="Bibliography" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Bibliography
              </span>
            </div>
          </a>
        
        
          <a href="../" title="Index" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Index
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Powered by
        <a href="http://timothycrosley.github.io/portray">portray.</a>
        You too can
        <a href="http://timothycrosley.github.io/portray">
          portray</a>
        your Python project well using automatic documentation.
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../../assets/javascripts/workers/search.f8263e09.min.js", "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.4fc53ad4.min.js"></script>
      
    
  </body>
</html>